import {AfterViewInit, Component} from '@angular/core';
import {XSVG} from "./XSVG/XSVG";
import {Rect} from "./XSVG/model/Rect";
import {XImage} from "./XSVG/element/foreign/media/XImage";
import {XForeignObject} from "./XSVG/element/foreign/XForeignObject";
import {Callback} from './XSVG/model/Callback';
import {XVideo} from "./XSVG/element/foreign/media/XVideo";

@Component({
  selector: 'app-root',
  templateUrl: './app.component.html',
  styleUrls: ['./app.component.scss']
})

export class AppComponent implements AfterViewInit {
  title = 'svg-board';

  private svg:XSVG | null = null;

  private activeTool: HTMLElement | null = null;

  public select() {
    if(!this.svg) return;
    this.svg.selectTool.on();
    this.switchActive('select');
  }
  public edit() {
    if(!this.svg) return;
    this.svg.editTool.on();
    this.switchActive('edit');
  }
  public grid() {
    if(!this.svg) return;
    if(this.svg.grid.isGrid()) {
      this.svg.grid.gridOff();
      this.makePassive('snap');
      this.makePassive('grid');
    } else {
      this.svg.grid.gridOn();
      this.makeActive('grid');
    }
  }
  public snap() {
    if(!this.svg) return;
    if(this.svg.grid.isSnap()) {
      this.svg.grid.snapOff();
      this.makePassive('snap');
    } else {
      this.svg.grid.gridOn();
      this.makeActive('grid');
      this.svg.grid.snapOn();
      this.makeActive('snap');
    }
  }
  group() {
    if(!this.svg) return;
    this.svg.focused.group();
  }
  ungroup() {
    if(!this.svg) return;
    this.svg.focused.ungroup();
  }
  public toPath() {
    if(!this.svg) return;
    this.svg.focused.toPath();
  }

  public rectangle() {
    if(!this.svg) return;
    this.svg.drawTool.tool = this.svg.drawTools.rectangle;
    this.svg.drawTool.on();
    this.switchActive('rect');
  }
  public ellipse() {
    if(!this.svg) return;
    this.svg.drawTool.tool = this.svg.drawTools.ellipse;
    this.svg.drawTool.on();
    this.switchActive('ellipse');
  }
  public triangle() {
    if(!this.svg) return;
    this.svg.drawTool.tool = this.svg.drawTools.isoscelesTriangle;
    this.svg.drawTool.on();
    this.switchActive('triangle');
  }
  public rightTriangle() {
    if(!this.svg) return;
    this.svg.drawTool.tool = this.svg.drawTools.rightTriangle;
    this.svg.drawTool.on();
    this.switchActive('right-triangle');
  }
  public line() {
    if(!this.svg) return;
    this.svg.drawTool.tool = this.svg.drawTools.line;
    this.svg.drawTool.on();
    this.switchActive('line');
  }
  public polyline() {
    if(!this.svg) return;
    this.svg.drawTool.tool = this.svg.drawTools.polyline;
    this.svg.drawTool.on();
    this.switchActive('polyline');
  }
  public polygon() {
    if(!this.svg) return;
    this.svg.drawTool.tool = this.svg.drawTools.polygon;
    this.svg.drawTool.on();
    this.switchActive('polygon');
  }
  public free() {
    if(!this.svg) return;
    this.svg.drawTool.tool = this.svg.drawTools.free;
    this.svg.drawTool.on();
    this.switchActive('free');
  }
  textBox() {
    if(!this.svg) return;
    this.svg.drawTool.tool = this.svg.drawTools.textBox;
    this.svg.drawTool.on();
    this.switchActive('text-box');
  }

  private keyDown(event: KeyboardEvent) {
    if(!this.svg) return;

    if(event.ctrlKey && event.key === "c") {
      this.copyFocused();
    }
    if(event.ctrlKey && event.key === "x") {
      this.cutFocused();
    }
    if(event.ctrlKey && event.key === "v") {
      this.paste();
    }
    if(event.ctrlKey && event.key === "a") {
      this.selectAll();
      event.preventDefault(); /* remove browser all selection */
    }

    if(event.shiftKey && event.key == "PageUp") {
      this.orderTop();
      event.preventDefault(); /* disable window scrolling */
    }
    if(event.shiftKey && event.key == "PageDown") {
      this.orderBottom();
      event.preventDefault(); /* disable window scrolling */
    }
    if(event.key == "ArrowLeft") {
      this.svg.focused.fixPosition();
      this.svg.focused.position = {x: -5, y: 0};
      if(!this.svg.editTool.isOn())
        event.preventDefault(); /* disable window scrolling */
    }
    if(event.key == "ArrowRight") {
      this.svg.focused.fixPosition();
      this.svg.focused.position = {x: +5, y: 0};
      if(!this.svg.editTool.isOn())
        event.preventDefault(); /* disable window scrolling */
    }
    if(event.key == "ArrowDown") {
      this.svg.focused.fixPosition();
      this.svg.focused.position = {x: 0, y: +5};
      if(!this.svg.editTool.isOn())
        event.preventDefault(); /* disable window scrolling */
    }
    if(event.key == "ArrowUp") {
      this.svg.focused.fixPosition();
      this.svg.focused.position = {x: 0, y: -5};
      if(!this.svg.editTool.isOn())
        event.preventDefault(); /* disable window scrolling */
    }

    if(event.key == "Shift") {
        this.svg.drawTool.perfect = true;
    }
    if(event.key == "Escape") {
      this.svg.selectTool.on();
    }
    if(event.key == "Control") {
      this.svg.multiSelect();
    }
  }
  showCoordinates(containerId: string, labelId: string, mask: string) { /* x: {x} y: {y} ... replace {x} to x coordinate and {y} to y*/
    let container = document.getElementById(containerId);
    let label = document.getElementById(labelId);

    container?.addEventListener("mousemove", (event) => {
      if(!container) return;
      let containerRect: Rect = container.getBoundingClientRect();
      let text = mask
          .replace("{x}", (event.clientX - containerRect.x) + "")
          .replace("{y}", (event.clientY - containerRect.y) + "");

      if(label)
        label.innerHTML = text;
    });
  }
  switchActive(id: string) {
    if(this.activeTool)
      this.makePassive(this.activeTool.id);

    this.activeTool = document.getElementById(id);
    if(this.activeTool)
      this.makeActive(this.activeTool.id);
  }

  makeActive(id: string) {
    let element = document.getElementById(id);
    if(!element) return;
    element.classList.add("active")
  }
  makePassive(id: string) {
    let element = document.getElementById(id);
    if(!element) return;
    element.classList.remove("active")
  }
  strokeWidthCallBack() {
    let stokeWidthInput = document.getElementById("stroke-width") as HTMLInputElement;
    if(!stokeWidthInput || !this.svg) return;
    stokeWidthInput.value = this.svg.style.globalStyle["stroke-width"];
  }

  strokeColorCallBack() {
    let stokeColorInput = document.getElementById("stroke-color") as HTMLInputElement;
    if(!stokeColorInput || !this.svg) return;
    stokeColorInput.value = this.svg.style.globalStyle["stroke"];
  }
  fillCallBack() {
    let fillInput = document.getElementById("fill-color") as HTMLInputElement;
    if(!fillInput || !this.svg) return;
    fillInput.value = this.svg.style.globalStyle["fill"];
  }
  selectToolCallBack() {
    this.switchActive("select")
  }
  editToolCallBack() {
    this.switchActive("edit")
  }
  focusChanged() {
    if(this.svg?.focused.canGroup)
      document.getElementById("group")?.removeAttribute("disabled");
    else
      document.getElementById("group")?.setAttribute("disabled", "true");

    if(this.svg?.focused.canUngroup)
      document.getElementById("ungroup")?.removeAttribute("disabled");
    else
      document.getElementById("ungroup")?.setAttribute("disabled", "true");
  }
  blured() {
    document.getElementById("group")?.setAttribute("disabled", "true");
    document.getElementById("ungroup")?.setAttribute("disabled", "true");
  }
  ngAfterViewInit(): void {
    this.svg = new XSVG("svgContainer");
    this.svg.addCallBack(Callback.SELECT_TOOl_ON, this.selectToolCallBack.bind(this));
    this.svg.addCallBack(Callback.EDIT_TOOl_ON, this.editToolCallBack.bind(this));
    this.svg.addCallBack(Callback.FOCUS_CHANGED, this.focusChanged.bind(this));
    this.svg.addCallBack(Callback.BLURED, this.blured.bind(this));

    this.svg.style.addCallBack(Callback.STOKE_WIDTH_CHANGE, this.strokeWidthCallBack.bind(this));
    this.svg.style.addCallBack(Callback.STROKE_COLOR_CHANGE, this.strokeColorCallBack.bind(this));
    this.svg.style.addCallBack(Callback.FILL_COLOR_CHANGE, this.fillCallBack.bind(this));

    this.select();
    window.addEventListener("keydown", this.keyDown.bind(this));
    window.addEventListener("keyup", this.keyUp.bind(this));

    this.showCoordinates("svgContainer", "coordinates", " x: {x} &emsp; y: {y}")
  }

  transparentStroke() {
    if(this.svg)
      this.svg.style.strokeColor = "none";
  }

  transparentFill() {
    if(this.svg)
      this.svg.style.fill = "none";
  }
  private keyUp(event: KeyboardEvent) {
    if(!this.svg) return;
    if(event.key == "Shift") {
      this.svg.drawTool.perfect = false;
    }
    if(event.key == "Delete") {
      this.svg.focused?.remove();
    }
    if(event.key == "Control") {
      this.svg.singleSelect();
    }
  }
  gridSideChange(event: Event) {
    let gridSide = document.getElementById((event.target as Element).id) as HTMLInputElement;
    let side = gridSide?.value;
    if(this.svg && side)
      this.svg.grid.snapSide = parseInt(side);
  }

  strokeWidthChange(event: Event) {
    let picker = document.getElementById((event.target as Element).id) as HTMLInputElement;
    let width = picker?.value;
    if(this.svg && width)
      this.svg.style.strokeWidth = width;
  }

  strokeColorChange(event: Event) {
    let picker = document.getElementById((event.target as Element).id) as HTMLInputElement;
    let color = picker?.value;
    if(this.svg && color)
      this.svg.style.strokeColor = color;
  }
  fillColorChange(event: Event) {
    let picker = document.getElementById((event.target as Element).id) as HTMLInputElement;
    let color = picker?.value;
    if(this.svg && color)
      this.svg.style.fill = color;
  }

  demoVideo() {
    if(!this.svg) return;
    let video = new XVideo(this.svg, 0, 0, 340, 200);
    video.refPoint = {x: 170, y: 100};
    video.src = "http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4";

    this.svg?.add(video);
  }
  demoImage() {
    if(!this.svg) return;
    let image = new XImage(this.svg, 0, 0, 340, 200);
    image.refPoint = {x: 170, y: 100};
    image.src = "/assets/test/img1.png";

    this.svg?.add(image);
  }

  demoAsset() {
    if(!this.svg) return;

    let htmlDiv = document.createElement("div");
    htmlDiv.innerHTML = "<div>For the given picture</div>\n" +
      "<div><span class=\"small-line-break\" xsl-notes=\"simplified-to-html\"></span></div>\n" +
      "<div>\n" +
      "  <div style=\"padding-left: 30px\">\n" +
      "    <table class=\"yes contentTable-border-no contentTable-padding-no contentTable-valign-top\" style=\"width:100%\">\n" +
      "      <tbody>\n" +
      "      <tr>\n" +
      "        <td>\n" +
      "          <table class=\"svg-html-wrapper\" style=\"width:6.6mm;\">\n" +
      "            <tbody>\n" +
      "            <tr class=\"svg-html-wrapper\">\n" +
      "              <td class=\"svg-html-wrapper\">\n" +
      "                <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"6mm\" id=\"svg_id_9E0C6A4D1546FEB679013D12ED1983DB_0\"\n" +
      "                     version=\"1.1\" viewBox=\"0.0 0.0 20.19906 20.19906\" web-src=\"resource_svg?key=87373kfqsejw1&amp;xw=7\"\n" +
      "                     width=\"7mm\" x=\"0px\" xml:space=\"preserve\" y=\"0px\">\n" +
      "<style type=\"text/css\">\n" +
      "\t.st0 {\n" +
      "    fill: none;\n" +
      "    stroke: #EE9147;\n" +
      "    stroke-miterlimit: 10;\n" +
      "  }\n" +
      "\n" +
      "  .st1 {\n" +
      "    fill: #EE9147;\n" +
      "  }\n" +
      "</style>\n" +
      "                  <g>\n" +
      "\t<circle cx=\"10.09953\" cy=\"10.09953\" r=\"9.59953\" style=\"fill:none;stroke:#EE9147;stroke-miterlimit:10;\"></circle>\n" +
      "                    <path\n" +
      "                      d=\"M7.96804,7.3559C8.29403,7.15884,8.674,7.01314,9.10794,6.91881   c0.43342-0.09434,0.88624-0.14255,1.35845-0.14255c0.44653,0,0.80501,0.06079,1.07596,0.18029   c0.27043,0.12054,0.4764,0.27777,0.61791,0.47064c0.14203,0.19287,0.23637,0.40565,0.28353,0.6373   c0.04717,0.23165,0.07075,0.46435,0.07075,0.696c0,0.51466-0.0131,1.01779-0.03878,1.50624   c-0.02568,0.4895-0.03826,0.95385-0.03826,1.39199c0,0.3176,0.01258,0.61738,0.03826,0.90144   c0.02568,0.28301,0.07285,0.54506,0.14203,0.78509h-0.75993l-0.27043-0.90144h-0.06446   c-0.07757,0.12054-0.174,0.23794-0.28982,0.35429c-0.11582,0.11635-0.25576,0.21907-0.41875,0.30921   c-0.16299,0.09014-0.35219,0.16561-0.56654,0.22536c-0.21488,0.05975-0.45963,0.09014-0.73425,0.09014   c-0.27515,0-0.53038-0.04298-0.76622-0.12893c-0.23637-0.08595-0.44024-0.20754-0.61214-0.36687   c-0.1719-0.15932-0.30712-0.35009-0.40565-0.57336c-0.09853-0.22326-0.14832-0.47692-0.14832-0.75993   c0-0.37735,0.07757-0.69285,0.23217-0.94651s0.37106-0.45491,0.6504-0.60585c0.27882-0.14989,0.61371-0.25681,1.00469-0.32179   c0.39045-0.06394,0.82178-0.09643,1.29451-0.09643c0.12002,0,0.23794,0,0.35429,0c0.11582,0,0.23375,0.00839,0.35376,0.02621   c0.0262-0.25785,0.03878-0.4895,0.03878-0.696c0-0.47168-0.09434-0.80291-0.28354-0.99158   c-0.18867-0.18867-0.53248-0.28301-1.03037-0.28301c-0.1457,0-0.3024,0.01048-0.47011,0.03249   C9.55866,7.73325,9.38676,7.76469,9.21067,7.80452c-0.1761,0.03983-0.34328,0.08805-0.50208,0.1457   S8.40985,8.07181,8.28983,8.14204L7.96804,7.3559z M9.79713,12.52136c0.24004,0,0.45491-0.03249,0.64359-0.09643   c0.1892-0.06499,0.35219-0.1457,0.4895-0.24528c0.13731-0.09853,0.25104-0.20754,0.34118-0.32808   c0.09067-0.12054,0.1567-0.23584,0.19968-0.348v-1.06915c-0.12002-0.00838-0.24265-0.01467-0.36687-0.01887   c-0.12473-0.00419-0.24685-0.00629-0.36687-0.00629c-0.26624,0-0.52619,0.01467-0.77933,0.04507   C9.70436,10.48369,9.4811,10.54029,9.28823,10.621c-0.19339,0.08176-0.348,0.19391-0.46382,0.33542   c-0.11582,0.1415-0.174,0.3197-0.174,0.53457c0,0.30083,0.10744,0.54715,0.32232,0.74002   C9.18708,12.42493,9.46223,12.52136,9.79713,12.52136z\"\n" +
      "                      style=\"fill:#EE9147;\"></path>\n" +
      "</g></svg>\n" +
      "              </td>\n" +
      "            </tr>\n" +
      "            </tbody>\n" +
      "          </table>\n" +
      "        </td>\n" +
      "        <td>&nbsp;list all of the triangles that are already drawn<br>&nbsp;in&nbsp;the&nbsp;picture&nbsp;without\n" +
      "          changing it.\n" +
      "          <div><span class=\"small-line-break\" xsl-notes=\"simplified-to-html\"></span></div>\n" +
      "        </td>\n" +
      "        <td rowspan=\"3\">\n" +
      "          <table class=\"svg-html-wrapper\" style=\"float:right;width:143.23pt;\">\n" +
      "            <tbody>\n" +
      "            <tr class=\"svg-html-wrapper\">\n" +
      "              <td class=\"svg-html-wrapper\">\n" +
      "                <svg xmlns=\"http://www.w3.org/2000/svg\" enable-background=\"new 0 0 143.2263 91.48111\" height=\"32mm\" id=\"svg_id_452B20194DEFF343E9EF6269E66EF6F5_0\" version=\"1.1\" viewBox=\"-0.17770815 0.0 143.404 90.3055\" web-src=\"resource_svg?key=83827kdhd619v&amp;xw=51\" width=\"51mm\" x=\"0px\" xml:space=\"preserve\" y=\"0px\"><style type=\"text/css\">\n" +
      "\t.st0 {\n" +
      "    font-family: 'Cambria';\n" +
      "  }\n" +
      "\n" +
      "  .st4 {\n" +
      "    font-family: 'Cambria';\n" +
      "    font-weight: bold;\n" +
      "  }\n" +
      "\n" +
      "  .st6 {\n" +
      "    font-family: 'Cambria';\n" +
      "    font-style: italic;\n" +
      "  }\n" +
      "\n" +
      "  .st1 {\n" +
      "    font-size: 12px;\n" +
      "  }\n" +
      "\n" +
      "  .st2 {\n" +
      "    font-size: 10px;\n" +
      "  }\n" +
      "\n" +
      "  .st3 {\n" +
      "    font-size: 8px;\n" +
      "  }\n" +
      "\n" +
      "  .tfr {\n" +
      "    fill: #FF0000;\n" +
      "  }\n" +
      "\n" +
      "  .ta-s {\n" +
      "    text-anchor: start;\n" +
      "  }\n" +
      "\n" +
      "  .ta-m {\n" +
      "    text-anchor: middle;\n" +
      "  }\n" +
      "\n" +
      "  .ta-e {\n" +
      "    text-anchor: end;\n" +
      "  }\n" +
      "</style>\n" +
      "<g id=\"svg_id_452B20194DEFF343E9EF6269E66EF6F5_1\">\n" +
      "\t<g>\n" +
      "\n" +
      "\t\t\t<line fill=\"none\" stroke=\"#000000\" stroke-miterlimit=\"10\" stroke-width=\"1.5\" x1=\"119.78331\" x2=\"119.78331\"\n" +
      "            y1=\"88.05202\" y2=\"1.65202\"></line>\n" +
      "\n" +
      "    <line fill=\"none\" stroke=\"#000000\" stroke-miterlimit=\"10\" stroke-width=\"1.5\" x1=\"25.68478\" x2=\"119.78331\"\n" +
      "          y1=\"79.01124\" y2=\"66.45202\"></line>\n" +
      "\n" +
      "    <line fill=\"none\" stroke=\"#000000\" stroke-miterlimit=\"10\" stroke-width=\"1.5\" x1=\"18.98305\" x2=\"119.78331\"\n" +
      "          y1=\"23.25202\" y2=\"66.45202\"></line>\n" +
      "\n" +
      "    <line fill=\"none\" stroke=\"#000000\" stroke-miterlimit=\"10\" stroke-width=\"1.5\" x1=\"0.57229\" x2=\"62.0975\" y1=\"1.51698\"\n" +
      "          y2=\"74.15128\"></line>\n" +
      "\n" +
      "    <line fill=\"none\" stroke=\"#000000\" stroke-miterlimit=\"10\" stroke-width=\"1.5\" x1=\"119.78331\" x2=\"62.0975\"\n" +
      "          y1=\"23.25202\" y2=\"74.15128\"></line>\n" +
      "\t</g>\n" +
      "  <g>\n" +
      "\t\t<rect fill=\"none\" height=\"10.146\" width=\"20.93624\" x=\"26.99072\" y=\"80.1595\" stroke-width=\"0\"></rect>\n" +
      "    <text style=\"fill: black; font-family:'Cambria'; font-weight: bold;font-size: 10px;text-anchor: start;\"\n" +
      "          transform=\"matrix(1 0 0 1 26.99073 88.49283)\">F</text>\n" +
      "\n" +
      "    <rect fill=\"none\" height=\"10.146\" width=\"20.93624\" x=\"58.91506\" y=\"75.7115\" stroke-width=\"0\"></rect>\n" +
      "    <text style=\"fill: black; font-family:'Cambria'; font-weight: bold;font-size: 10px;text-anchor: middle;\"\n" +
      "          transform=\"matrix(1 0 0 1 62.21505 84.04507)\">B</text>\n" +
      "\n" +
      "    <rect fill=\"none\" height=\"10.146\" width=\"20.93624\" x=\"122.29006\" y=\"79.55804\" stroke-width=\"0\"></rect>\n" +
      "    <text style=\"fill: black; font-family:'Cambria'; font-weight: bold;font-size: 10px;text-anchor: start;\"\n" +
      "          transform=\"matrix(1 0 0 1 122.29005 87.89175)\">G</text>\n" +
      "\n" +
      "    <rect fill=\"none\" height=\"10.146\" width=\"20.93624\" x=\"122.29006\" y=\"61.33504\" stroke-width=\"0\"></rect>\n" +
      "    <text style=\"fill: black; font-family:'Cambria'; font-weight: bold;font-size: 10px;text-anchor: start;\"\n" +
      "          transform=\"matrix(1 0 0 1 122.29005 69.66861)\">C</text>\n" +
      "\n" +
      "    <rect fill=\"none\" height=\"10.146\" width=\"20.93624\" x=\"122.29006\" y=\"18\" stroke-width=\"0\"></rect>\n" +
      "    <text style=\"fill: black; font-family:'Cambria'; font-weight: bold;font-size: 10px;text-anchor: start;\"\n" +
      "          transform=\"matrix(1 0 0 1 122.29005 26.33365)\">D</text>\n" +
      "\n" +
      "    <rect fill=\"none\" height=\"10.146\" width=\"20.93624\" x=\"122.29006\" stroke-width=\"0\"></rect>\n" +
      "    <text style=\"fill: black; font-family:'Cambria'; font-weight: bold;font-size: 10px;text-anchor: start;\"\n" +
      "          transform=\"matrix(1 0 0 1 122.29005 8.33365)\">H</text>\n" +
      "\n" +
      "    <rect fill=\"none\" height=\"10.146\" width=\"20.93624\" x=\"81.91506\" y=\"39.7115\" stroke-width=\"0\"></rect>\n" +
      "    <text style=\"fill: black; font-family:'Cambria'; font-weight: bold;font-size: 10px;text-anchor: middle;\"\n" +
      "          transform=\"matrix(1 0 0 1 85.31505 48.04508)\">O</text>\n" +
      "\n" +
      "    <rect fill=\"none\" height=\"10.146\" width=\"20.93624\" x=\"18.91506\" y=\"12.90346\" stroke-width=\"0\"></rect>\n" +
      "    <text style=\"fill: black; font-family:'Cambria'; font-weight: bold;font-size: 10px;text-anchor: start;\"\n" +
      "          transform=\"matrix(1 0 0 1 18.91505 21.23697)\">A</text>\n" +
      "\n" +
      "    <rect fill=\"none\" height=\"10.146\" width=\"20.93624\" x=\"8.44695\" y=\"0.1115\" stroke-width=\"0\"></rect>\n" +
      "    <text style=\"fill: black; font-family:'Cambria'; font-weight: bold;font-size: 10px;text-anchor: start;\"\n" +
      "          transform=\"matrix(1 0 0 1 8.44703 8.44498)\">E</text>\n" +
      "\t</g>\n" +
      "</g></svg>\n" +
      "              </td>\n" +
      "            </tr>\n" +
      "            </tbody>\n" +
      "          </table>\n" +
      "          <div><span class=\"small-line-break\" xsl-notes=\"simplified-to-html\"></span></div>\n" +
      "        </td>\n" +
      "      </tr>\n" +
      "      <tr>\n" +
      "        <td>\n" +
      "          <table class=\"svg-html-wrapper\" style=\"width:6.6mm;\">\n" +
      "            <tbody>\n" +
      "            <tr class=\"svg-html-wrapper\">\n" +
      "              <td class=\"svg-html-wrapper\">\n" +
      "                <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"6mm\" id=\"svg_id_C7E0B4B9A9392B1B3E1E1377438B0A14_0\" version=\"1.1\" viewBox=\"0.0 0.0 20.19906 20.19906\" web-src=\"resource_svg?key=87374kfqsespt&amp;xw=7\" width=\"7mm\" x=\"0px\" xml:space=\"preserve\" y=\"0px\"><style type=\"text/css\">\n" +
      "\t.st0 {\n" +
      "    fill: none;\n" +
      "    stroke: #EE9147;\n" +
      "    stroke-miterlimit: 10;\n" +
      "  }\n" +
      "\n" +
      "  .st1 {\n" +
      "    fill: #EE9147;\n" +
      "  }\n" +
      "</style><g>\n" +
      "\t<circle cx=\"10.09953\" cy=\"10.09953\" r=\"9.59953\" style=\"fill:none;stroke:#EE9147;stroke-miterlimit:10;\"></circle>\n" +
      "                  <path\n" +
      "                    d=\"M7.43294,5.00522h1.03037v3.2064h0.05241c0.19706-0.24842,0.44862-0.44129,0.7526-0.57965   c0.30502-0.13731,0.63834-0.20544,0.99892-0.20544c0.83226,0,1.45698,0.26624,1.87416,0.79872   c0.41613,0.53248,0.62472,1.35635,0.62472,2.47267c0,1.1247-0.27567,1.97898-0.82492,2.56281   c-0.54925,0.58384-1.32176,0.87628-2.31859,0.87628c-0.48007,0-0.91611-0.05136-1.30709-0.15513   c-0.39097-0.10272-0.68447-0.21383-0.88257-0.33437V5.00522z M10.08695,8.32797c-0.42976,0-0.77775,0.12054-1.04399,0.36058   C8.77672,8.92858,8.58385,9.2682,8.46331,9.70634v3.24518c0.16352,0.09538,0.36162,0.16561,0.59327,0.21278   c0.23165,0.04717,0.47168,0.07128,0.72115,0.07128c0.58384,0,1.04923-0.20649,1.39723-0.61843s0.522-1.05657,0.522-1.93181   c0-0.33542-0.0304-0.64883-0.09014-0.94022c-0.06079-0.29244-0.15513-0.54086-0.28406-0.74736   c-0.12788-0.20649-0.29349-0.36896-0.49579-0.4895C10.62572,8.38772,10.37834,8.32797,10.08695,8.32797z\"\n" +
      "                    style=\"fill:#EE9147;\"></path>\n" +
      "</g></svg>\n" +
      "              </td>\n" +
      "            </tr>\n" +
      "            </tbody>\n" +
      "          </table>\n" +
      "        </td>\n" +
      "        <td>&nbsp;for each triangle, list the exterior angle&nbsp;(s) that are<br>&nbsp;already drawn in&nbsp;the&nbsp;picture\n" +
      "          without&nbsp;changing it.&nbsp;\n" +
      "          <div><span class=\"small-line-break\" xsl-notes=\"simplified-to-html\"></span></div>\n" +
      "        </td>\n" +
      "      </tr>\n" +
      "      <tr>\n" +
      "        <td>\n" +
      "          <table class=\"svg-html-wrapper\" style=\"width:6.6mm;\">\n" +
      "            <tbody>\n" +
      "            <tr class=\"svg-html-wrapper\">\n" +
      "              <td class=\"svg-html-wrapper\">\n" +
      "                <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"6mm\" id=\"svg_id_85F8055383BB1D0D1B360451F108770D_0\" version=\"1.1\" viewBox=\"0.0 0.0 20.19906 20.19906\" web-src=\"resource_svg?key=87375kfqsf045&amp;xw=7\" width=\"7mm\" x=\"0px\" xml:space=\"preserve\" y=\"0px\"><style type=\"text/css\">\n" +
      "\t.st0 {\n" +
      "    fill: none;\n" +
      "    stroke: #EE9147;\n" +
      "    stroke-miterlimit: 10;\n" +
      "  }\n" +
      "\n" +
      "  .st1 {\n" +
      "    fill: #EE9147;\n" +
      "  }\n" +
      "</style><g>\n" +
      "\t<g>\n" +
      "\t\t<circle cx=\"10.09953\" cy=\"10.09953\" r=\"9.59953\" style=\"fill:none;stroke:#EE9147;stroke-miterlimit:10;\"></circle>\n" +
      "\t</g>\n" +
      "                  <g>\n" +
      "\t\t<path\n" +
      "      d=\"M12.26601,12.99544c-0.25977,0.19092-0.56738,0.33594-0.92285,0.43555S10.61562,13.5804,10.225,13.5804    c-0.50195,0-0.92676-0.08008-1.27344-0.24023S8.3207,12.95003,8.1,12.6512c-0.2207-0.29883-0.38184-0.65869-0.48145-1.0791    s-0.14941-0.88623-0.14941-1.39746c0-1.10059,0.24316-1.94336,0.72852-2.52832s1.18262-0.87744,2.09277-0.87744    c0.41602,0,0.76855,0.03223,1.05957,0.09717c0.29004,0.06494,0.55273,0.1582,0.78613,0.27979L11.8373,8.04281    c-0.19922-0.11279-0.41992-0.20166-0.66309-0.2666c-0.24219-0.06494-0.50293-0.09766-0.78027-0.09766    c-1.23047,0-1.8457,0.83203-1.8457,2.49609c0,0.32959,0.03223,0.64355,0.09766,0.94238    c0.06543,0.29932,0.17285,0.56348,0.3252,0.79297c0.15137,0.22998,0.35059,0.41406,0.59766,0.55273    s0.55273,0.20801,0.91699,0.20801c0.31152,0,0.59082-0.04785,0.83789-0.14307s0.44922-0.20361,0.60449-0.3252L12.26601,12.99544z\"\n" +
      "      style=\"fill:#EE9147;\"></path>\n" +
      "\t</g>\n" +
      "</g></svg>\n" +
      "              </td>\n" +
      "            </tr>\n" +
      "            </tbody>\n" +
      "          </table>\n" +
      "        </td>\n" +
      "        <td>&nbsp;for each of the exterior angles in part&nbsp;(b), identify<br>&nbsp;its remote interior angles in the\n" +
      "          corresponding<br>&nbsp;triangle&nbsp;(s).\n" +
      "          <div><span class=\"small-line-break\" xsl-notes=\"simplified-to-html\"></span></div>\n" +
      "          <div>\n" +
      "            m∠A<span style=\"margin-left:2px;margin-right:2px\">=</span>65°, m∠B<span\n" +
      "            style=\"margin-left:2px;margin-right:2px\">=</span>57°\n" +
      "          </div>\n" +
      "        </td>\n" +
      "      </tr>\n" +
      "      </tbody>\n" +
      "    </table>\n" +
      "  </div>\n" +
      "</div>\n"

    let element = new XForeignObject(this.svg, 0, 0, 600, 200);
    element.refPoint = {x: 300, y: 100};
    element.setContent(htmlDiv);

    this.svg.add(element);
  }

  copyFocused() {
    if(!this.svg) return;
    this.svg.copyFocused();
  }
  cutFocused() {
    if(!this.svg) return;
    this.svg.cutFocused();
  }
  paste() {
    if(!this.svg) return;
    this.svg.paste();
  }
  selectAll() {
    if(!this.svg) return;
    this.svg.focusAll();
  }
  delete() {
    if(!this.svg) return;
    this.svg.focused.remove();
  }
  orderTop() {
    if(!this.svg) return;
    this.svg.focused.orderTop();
  }
  orderBottom() {
    if(!this.svg) return;
    this.svg.focused.orderBottom();
  }

  recenterRefPoint() {
    if(!this.svg) return;
    this.svg.focused.recenterRefPoint();
  }
}
